<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>AdminLTE | Dashboard</title>
        <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
        <meta content="text/html; charset=UTF-8" http-equiv="content-type" />
        <!-- bootstrap 3.0.2 -->
        <link href="../css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <!-- font Awesome -->
        <link href="../css/font-awesome.min.css" rel="stylesheet" type="text/css" />
        <!-- Ionicons -->
        <link href="../css/ionicons.min.css" rel="stylesheet" type="text/css" />
        <!-- Morris chart -->
        <!-- <link href="css/morris/morris.css" rel="stylesheet" type="text/css" /> -->
        <!-- jvectormap -->
        <!-- <link href="css/jvectormap/jquery-jvectormap-1.2.2.css" rel="stylesheet" type="text/css" /> -->
        <!-- fullCalendar -->
        <!-- <link href="css/fullcalendar/fullcalendar.css" rel="stylesheet" type="text/css" /> -->
        <!-- Daterange picker -->
        <!-- <link href="css/daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css" /> -->
        <!-- bootstrap wysihtml5 - text editor -->
        <!-- <link href="css/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css" rel="stylesheet" type="text/css" /> -->


        <!-- Theme style -->
        <!--
        <link href="css/AdminLTE.css" rel="stylesheet" type="text/css" />
        -->
        <link rel="stylesheet/less" type="text/css" href="../less/AdminLTE.less" />
        <script>
          less = {
            env: "development",
            async: false,
            fileAsync: false,
            poll: 100000,
            functions: {},
            dumpLineNumbers: "comments",
            relativeUrls: false,
            // rootpath: ":/a.com/"
          };
        </script>        
        <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js"></script>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
          <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        <!-- jQuery 2.0.2 -->
        <!--
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
        <script src="js/jquery-2.1.1.min.js"></script>
        -->
        <script src="../js/jquery-2.0.2.min.js"></script>
        <!-- jQuery UI 1.10.3 -->
        <script src="../js/jquery-ui-1.10.3.min.js" type="text/javascript"></script>
        <!-- Bootstrap -->
        <script src="../js/bootstrap.min.js" type="text/javascript"></script>
    </head>
  <style>

ul.source, ul.target {
  min-height: 50px;
  /*margin: 0px 25px 10px 0px;*/
  padding: 2px;
  border-width: 1px;
  border-style: solid;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  list-style-type: none;
  list-style-position: inside;
}
ul.source {
  border-color: #f8e0b1;
}
ul.target {
  border-color: #add38d;
}

.source li, .target li {
  position: relative;
  margin: 5px;
  padding: 5px;
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  border-radius: 4px;
  text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
}
.source li {
  background-color: #fcf8e3;
  border: 1px solid #fbeed5;
  color: #c09853;
}
.target li {
  background-color: #ebf5e6;
  border: 1px solid #d6e9c6;
  color: #468847;
}

.sub_target li {
  background-color: #ebf5e6;
  border: 1px solid #d6e9c6;
  color: #468847;
}

.sortable-dragging {
  border-color: #ccc !important;
  background-color: #fafafa !important;
  color: #bbb !important;
}
.sortable-placeholder {
  height: 40px;
}

.source .sortable-placeholder {
  border: 2px dashed #f8e0b1 !important;
  background-color: #fefcf5 !important;
}

.target .sortable-placeholder {
  border: 2px dashed #add38d !important;
  background-color: #f6fbf4 !important;
}
.sideBySide{
  width: 500px
}

.sideBySide .left {
  float: left;
}

.sideBySide .left, .sideBySide .right {
  display: inline-block;
  width: 230px;
  padding: 0;
  margin: 0;
}
.sideBySide .right {
  float: right;
}

.sortable.grid {
  overflow: hidden;
}

.portlet-placeholder {
    border: 1px dotted black!important;
    margin: 0 1em 1em 0;
    height: 20px;
}


.sub_group {
    /*border: 2px dotted black!important;*/
    /*margin: 10px 1em 1em 0;*/
    padding-top: 15px!important;
    /*height: 20px;*/
}

.top_right_corner {
    position: absolute;
    top: 0px;
    right: 0px;
    border: 1px solid #eee;
}

.btn_corner {
  font-size:11px;
}

.btn_corner > i.fa {
  cursor:pointer;
}

.xxx {
  border: 1px dotted black!important;
  cursor:pointer;
}
</style>

</head>
<body>

<ul>
  <li><s>동적 group 추가시 문제 : droppable 안먹는 문제.</s></li>
  <li><s>동적 group 추가시 문제 : 한번 클릭해야 draggable 되는 문제.</s></li>
  <li>group source에 droped 안되게 </li>
  <li>group dismiss 아이콘은 X표시로</li>
  <li><s>group 상하 버튼 동작 안되는 문제</s></li>
  <li><s>group dismiss 클릭 시 삭제 안되는 문제</s></li>
  <li>group dismiss 삭제시 안에 있던 element source로 반환 안되는 문제</li>
  <li>group 표현 다르게, 회사 노트북 색감 대박 </li>
  <li>group이 있는 상태에서 button으로 element 추가시 root와 sub group 둘다 추가되는 문제. </li>
  <li>선택한 target(root or sub)에 등록되도록 기능 향상</li>
  <li>갖가지 문제는 좀더 추가하기로</li>
</ul>

<button id="add_group" class="btn btn-primary">new sub group</button>
<button id="add_elem" class="btn btn-primary">source element</button>
<div class="sideBySide">
  <div class="left">
    <ul class="source connected">
      <li>Alfa Romeo</li>
      <li>Audi</li>
      <li>BMW</li>
      <li>Ford</li>
      <li>Jaguar</li>
      <li>Mercedes</li>
      <li>Porsche</li>
      <li>Tesla</li>
      <li>Volkswagen</li>
      <li>Volvo</li>
    </ul>
  </div>
  <div class="right">
    target
    <ul class="target target_root connected">
    </ul>
  </div>
</div>


<table width="100%" border=1>
  <tr>
    <td id="xconsole">
      aa
    </td>
  </tr>
</table>
</body>
</html>


<script>
var buttons = ''
  + '<div class="top_right_corner btn_corner">'
  + '  <i class="fa fa-fw fa-chevron-up up"></i>'
  + '  <i class="fa fa-fw fa-chevron-down down"></i>'
  + '  <i class="fa fa-fw fa-plus dismiss"></i>'
  + '</div>';


var sortable_opts = {
    connectWith: ".connected",
    placeholder: "portlet-placeholder ui-corner-all",
    // tolerance: "pointer",
    start: function(e, ui){
        console.log("sortable start");
        ui.placeholder.height(ui.item.height());
    },

    // events
    activate: function( event, ui ) {
      console.log("sortable activate");
    },
    deactivate: function( event, ui ) {
      console.log("sortable deactivate");
    },
    beforeStop : function( event, ui ) {
      console.log("sortable beforeStop");
    },
    change : function( event, ui ) {
      console.log("sortable chnage");
    },
    // over : function(event, ui){
    //   console.log("sortable over");
    // },
    // out : function(event, ui){
    //   console.log("sortable out");
    // },
    stop : function(event, ui){
      console.log("sortable stop");
    },
    sort : function(event, ui){
      console.log("sortable sort");
    },
    update : function(event, ui){
      console.log("sortable update");
    },
    receive : function(event, ui){
      console.log("sortable sort");
    },
    remove : function(event, ui){
      console.log("sortable update");
    },
    drop: function(event, ui) {
      event.stopPropagation();
    }    
};


var droppable_source_opts = {
  activeClass: "listActive",
    // events
    activate: function( event, ui ) {
      console.log("droppable-source activate");
    },
    deactivate: function( event, ui ) {
      console.log("droppable-source deactivate");
    },
    beforeStop : function( event, ui ) {
      console.log("droppable-source beforeStop");
    },
    change : function( event, ui ) {
      console.log("droppable-source chnage");
    },
    // over : function(event, ui){
    //   console.log("droppable-source over");
    // },
    // out : function(event, ui){
    //   console.log("droppable-source out");
    // },
    start : function(event, ui){
      console.log("droppable-source start");
    },
    stop : function(event, ui){
      console.log("droppable-source stop");
    },
    sort : function(event, ui){
      console.log("droppable-source sort");
    },
    update : function(event, ui){
      console.log("droppable-source update");
    },
    receive : function(event, ui){
      console.log("droppable-source sort");
    },
    remove : function(event, ui){
      console.log("droppable-source update");
    },
};

var droppable_target_opts = {
    // addClasses: false,
    activeClass: "listActive",
    live: true,

    // events
    activate: function( event, ui ) {
      console.log("droppable activate");
    },
    deactivate: function( event, ui ) {
      console.log("droppable deactivate");
    },
    beforeStop : function( event, ui ) {
      console.log("droppable beforeStop");
    },
    change : function( event, ui ) {
      console.log("droppable chnage");
    },
    over : function(event, ui){
      console.log("droppable over");
    },
    out : function(event, ui){
      console.log("droppable out");
    },
    start : function(event, ui){
      console.log("droppable start");
    },
    stop : function(event, ui){
      console.log("droppable stop");
    },
    sort : function(event, ui){
      console.log("droppable sort");
    },
    update : function(event, ui){
      console.log("droppable update");
    },
    receive : function(event, ui){
      console.log("droppable sort");
    },
    remove : function(event, ui){
      console.log("droppable update");
    },
    drop: function(event, ui) {
      event.stopPropagation();
    }
};

var elem_group = '<ul class="sub_group target connected" style="position:relative"></ul>';

$(function () {

// init
$("i.fa").mouseover(function(){
  $(this).css('color', 'blue');
});

$("ul.source > li").append(buttons);

function isReverseFind(elem, className){
  console.log(elem);
  var is_subgroup = (elem.parents().map(function() {
    if ($(this).hasClass(className)){
      return true;
    } else {
      return null;
    }
  })[0]) ? true : false;
  console.log(is_subgroup);
  return is_subgroup;
}

$(".sideBySide").on("click", ".btn_corner .dismiss", function(event){
  $(this).toggleClass( "selected" );
  
  //is group
  if(isReverseFind($(this), "sub_group")){
    $(this).closest('.sub_group').parent().remove();
  } else {
    //is source
    if(isReverseFind($(this), "source")){
      $(this).parentsUntil($("li" )).parent().appendTo($(".target_root"));
      // $(this).parent().parent().appendTo($(".target_root"));
    } else { //is target
      $(this).parentsUntil($("li" )).parent().appendTo($(".source"));
      // $(this).parent().parent().appendTo($(".source"));
    }
  }
});

$(".sideBySide").on("click", ".btn_corner .up", function(event){
  if(isReverseFind($(this), "sub_group")){
    console.log('is sub group');
    var node = $(this).parent().parent().parent().prev();
    if(node.length > 0){
      node.before($(this).parent().parent());
    }
  } else {
    var node = $(this).parent().parent().prev();
    if(node.length > 0){
      node.before($(this).parent().parent());
    }
  }
});

$(".sideBySide").on("click", ".btn_corner .down", function(event){
  if(isReverseFind($(this), "sub_group")){
    console.log('is sub group');
  } else {
    var node = $(this).parent().parent().next();
    if(node.length > 0){
      node.after($(this).parent().parent());
    }
  }
});


// init droppable & sortable
// $(".source").droppable(droppable_source_opts);
// $(".target").droppable(droppable_target_opts);
$(".target, .source").sortable(sortable_opts);


$("#add_group").click(function(e){
  e.preventDefault();
  var sub_target = $(elem_group);
  sub_target.append(buttons);
  sub_target.sortable(sortable_opts);
  sub_target.droppable(droppable_source_opts);
  var new_li = $("<li></li>");
  sub_target.appendTo(new_li);
  new_li.find(".dismiss").removeClass("fa-plus").addClass("fa-times");
  $("ul.target_root").append(new_li);
});


$("#add_elem").click(function(e){
  e.preventDefault();
  var new_elem = $('<li>Audi</li>');
  new_elem.sortable(sortable_opts);
  $("ul.source").append(new_elem);
});

/*
임시 
*/

/* --------------------------------------

----------------------------------------- */


var new_elem = $('<li>Audi</li>');
var buttons2 = $(buttons);
new_elem.append(buttons2);
new_elem.sortable(sortable_opts);
$("ul.source").append(new_elem);
/* --------------------------------------

----------------------------------------- */
  var sub_target = $(elem_group);
  sub_target.append(buttons);
  sub_target.sortable(sortable_opts);
  sub_target.droppable(droppable_source_opts);
  var new_li = $("<li></li>");
  sub_target.appendTo(new_li);
  new_li.find(".dismiss").removeClass("fa-plus");
  new_li.find(".dismiss").addClass("fa-times");
  $("ul.target_root").append(new_li);

}); //end document read
</script>
